unsigned char boot_js[] ="(()=>{var l=class{constructor(){this._e={}}on(e,i){this._e[e]||(this._e[e]=[]),this._e[e].push(i)}off(e,i){let n=this._e[e];if(!n)return;let r=n.indexOf(i);r!==-1&&n.splice(r,1),n.length===0&&delete this._e[e]}emit(e,i){let n=this._e[e];if(n)for(let r of[...n])r(i)}};function D(t){try{return JSON.parse(t)}catch{}}var u=class extends l{constructor(e){super(),this.serial=e,this.line=\"\",this.serial.on(\"data\",i=>{for(let n of i)this.handleInput(n)}),this.on(\"line\",i=>this.handleLine(i)),this.prompt()}prompt(){this.serial.write(\"> \"),this.line=\"\"}handleLine(e){try{let i=global.eval(e);this.serial.write(String(i)),this.serial.write(`\n`)}catch(i){this.serial.write(`\n`),this.serial.write(`\n`),this.serial.write(`\n`),this.serial.write(\"Line: \"+e),this.serial.write(`\n`),this.serial.write(\"The Error: \"+i.message),this.serial.write(`\n`)}}handleInput(e){if(e=String(e),e===\"\"){this.serial.write(`^C\n`),this.prompt();return}if(e===`\n`){this.serial.write(`\n`);let i=D(this.line);i&&this.line.trim().startsWith(\"{\")?this.emit(\"message\",i):this.line.trim().length&&this.emit(\"line\",this.line),this.line=\"\",this.prompt();return}if(e===\"\b\"||e===\"\x7F\"){this.line.length>0&&(this.line=this.line.slice(0,-1),this.serial.write(\"\b \b\"));return}this.line+=e,this.serial.write(e)}};var d={defines:{COF_FUNC_NMT:0,COF_FUNC_SDO_TX:11,COF_FUNC_SDO_RX:12,COF_FUNC_HEARTBEAT:14,COF_SDO_CMD_DOWNLOAD:1,COF_SDO_CMD_UPLOAD:2,COF_SDO_CMD_ABORT:4,COF_SDO_SCS_UPLOAD_REPLY:2,COF_SDO_SCS_DOWNLOAD_REPLY:3,COF_SDO_SCS_ABORT:4,COF_ABORT_TOGGLE:84082688,COF_ABORT_TIMEOUT:84148224,COF_ABORT_CMD:84148225,COF_ABORT_OUT_OF_MEM:84148229,COF_ABORT_UNSUPPORTED:100728832,COF_ABORT_WRITEONLY:100728833,COF_ABORT_READONLY:100728834,COF_ABORT_NOT_EXIST:100794368,COF_ABORT_PARAM_RANGE:101253168,COF_ABORT_GENERAL:134217728,COF_HB_BOOTUP:0,COF_HB_STOPPED:4,COF_HB_OPERATIONAL:5,COF_HB_PREOP:127},dataBits:{COF_SDO_CMD:{offs:5,len:3},COF_SDO_N_UNUSED:{offs:2,len:2},COF_SDO_EXPEDITED:{offs:1,len:1},COF_SDO_SIZE_IND:{offs:0,len:1},COF_SDO_INDEX:{offs:8,len:16},COF_SDO_SUBINDEX:{offs:24,len:8},COF_SDO_DATA_0:{offs:32,len:8},COF_SDO_DATA_1:{offs:40,len:8},COF_SDO_DATA_2:{offs:48,len:8},COF_SDO_DATA_3:{offs:56,len:8},COF_SDO_ABORT_CODE:{offs:32,len:32},COF_HEARTBEAT_STATE:{offs:0,len:8}},cobBits:{COF_FUNC:{offs:7,len:4},COF_NODE_ID:{offs:0,len:7}}};function c(t){if(t=t.trim(),t.length===0)return;let e=t[0];if(![\"t\",\"T\",\"r\",\"R\"].includes(e))return;let i=e===\"T\"||e===\"R\",n=e===\"r\"||e===\"R\";if(i){if(t.length<10)return;let r=parseInt(t.substring(1,9),16);if(Number.isNaN(r))return;let o=parseInt(t[9],16);if(Number.isNaN(o)||o<0||o>8)return;if(n)return t.length!==10?void 0:{id:r,data:new Uint8Array(0),ext:!0,rtr:!0};{let O=10+o*2;if(t.length!==O)return;let h=new Uint8Array(o),_=10;for(let f=0;f<o;f++){let a=parseInt(t.substring(_,_+2),16);if(Number.isNaN(a))return;h[f]=a,_+=2}return{id:r,data:h,ext:!0,rtr:!1}}}else{if(t.length<5)return;let r=parseInt(t.substring(1,4),16);if(Number.isNaN(r))return;let o=parseInt(t[4],16);if(Number.isNaN(o)||o<0||o>8)return;if(n)return t.length!==5?void 0:{id:r,data:new Uint8Array(0),ext:!1,rtr:!0};{let O=5+o*2;if(t.length!==O)return;let h=new Uint8Array(o),_=5;for(let f=0;f<o;f++){let a=parseInt(t.substring(_,_+2),16);if(Number.isNaN(a))return;h[f]=a,_+=2}return{id:r,data:h,ext:!1,rtr:!1}}}}function C(t){if(!t||typeof t.id!=\"number\")return;let e=t.id,i=!!t.ext,n=!!t.rtr,r=0,o=[];if(!n&&t.data!=null){let a=t.data;if(ArrayBuffer.isView(a))r=Math.min(a.length,8),o=Array.from(a.slice(0,r));else if(Array.isArray(a))r=Math.min(a.length,8),o=a.slice(0,r);else return}let O=n?i?\"R\":\"r\":i?\"T\":\"t\",h=i?e.toString(16).padStart(8,\"0\").toUpperCase().slice(-8):e.toString(16).padStart(3,\"0\").toUpperCase().slice(-3),_=r.toString(16).toUpperCase(),f=\"\";return!n&&r>0&&(f=o.map(a=>a.toString(16).padStart(2,\"0\").toUpperCase()).join(\"\")),O+h+_+f}function F(t,e,i){let n=0;for(let r=0;r<i;r++){let o=e+r,O=o>>3,h=o&7;t[O]&1<<h&&(n|=1<<r)}return n>>>0}function g(t,e,i,n){for(let r=0;r<i;r++){let o=e+r,O=o>>3,_=1<<(o&7);n&1<<r?t[O]|=_:t[O]&=~_}}function S(t,e){e[0]=t>>>0&255,e[1]=t>>>8&255,e[2]=t>>>16&255,e[3]=t>>>24&255}function E(t){return(t[0]<<0|t[1]<<8|t[2]<<16|t[3]<<24)>>>0}var s=class t{constructor(e){this.id=0,this.data=new Uint8Array(8),typeof e==\"string\"?Object.assign(this,c(e)):e&&Object.assign(this,e)}set(e,i){if(e in t.cobBits){let n=t.cobBits[e],r=new Uint8Array(4);S(this.id,r),g(r,n.offs,n.len,i),this.id=E(r)&2047;return}if(e in t.dataBits){let n=t.dataBits[e];n.len<32&&(i&=(1<<n.len)-1),g(this.data,n.offs,n.len,i);return}switch(e){case\"COF_COB_ID\":cof.id=i;return;case\"COF_DLC\":throw new Error(\"WIP\")}throw new Error(`write unknown prop: ${e}`)}toSlcan(e){return C(this)}get(e){if(e in t.cobBits){let i=t.cobBits[e],n=new Uint8Array(4);return S(this.id,n),F(n,i.offs,i.len)}if(e in t.dataBits){let i=t.dataBits[e];return F(this.data,i.offs,i.len)}switch(e){case\"COF_COB_ID\":return this.id;case\"COF_DLC\":return this.data.length}throw new Error(`read unknown prop: ${e}`)}};for(let t in d.defines)s[t]=d.defines[t];for(let t in d.dataBits)s[t]=t;for(let t in d.cobBits)s[t]=t;s.dataBits=d.dataBits;s.cobBits=d.cobBits;s.sdoErrors={};s.sdoErrors[s.COF_ABORT_TOGGLE]=\"Toggle bit not alternated\";s.sdoErrors[s.COF_ABORT_TIMEOUT]=\"SDO protocol timed out\";s.sdoErrors[s.COF_ABORT_COMMAND]=\"Command specifier not valid or unknown\";s.sdoErrors[s.COF_ABORT_OUT_OF_MEMORY]=\"Out of memory\";s.sdoErrors[s.COF_ABORT_UNSUPPORTED_ACCESS]=\"Unsupported access to an object\";s.sdoErrors[s.COF_ABORT_NOT_EXIST]=\"Object does not exist in OD\";s.sdoErrors[s.COF_ABORT_READONLY]=\"Attempt to write a read-only object\";s.sdoErrors[s.COF_ABORT_TYPE_MISMATCH]=\"Data type does not match\";s.sdoErrors[s.COF_ABORT_LENGTH_EXCEEDED]=\"Length of service parameter too high\";s.sdoErrors[s.COF_ABORT_SUBINDEX]=\"Subindex does not exist\";s.sdoErrors[s.COF_ABORT_DEVICE_STATE]=\"Device internal error\";global.EventEmitter=l;global.serial=new l;serial.write=t=>serialWrite(t);setSerialDataFunc(t=>serial.emit(\"data\",t));global.console={};console.log=(...t)=>serialWrite(t.map(e=>String(e)).join(\" \")+`\r\n`);repl=new u(serial);repl.on(\"message\",t=>{if(!(t.type!=\"call\"&&!t.method))try{let e=global[t.method](...t.params);serial.write(JSON.stringify({id:t.id,result:e})+`\n`)}catch(e){serial.write(JSON.stringify({id:t.id,error:{message:String(e)}})+`\n`)}});global.canBus=new l;global.canBus.write=t=>{let e=C(t);canWrite(e)};global.canBus.send=global.canBus.write;setCanMessageFunc(t=>{global.canBus.emit(\"message\",c(t))});})();\n";
